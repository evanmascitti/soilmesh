---
title: "Cleat-mark device data report"
author: "Evan C. Mascitti"
date: "Report compiled `r strftime(Sys.time(), format = '%a %e %b %Y, %I:%M %p')`"
params: 
  test_dates: ["2021-02-21", "2021-02-22"]
output:
  bookdown::html_document2:
    number_sections: false
    css: "basic_sans_theme.css"
########################################################################
  bookdown::pdf_document2:
    number_sections: false
    latex_engine: xelatex
    mainfont: Arial
    mathfont: Fira Math Regular
    codefont: Lucida Console
    links-as-notes: true
    papersize: letter
    geometry: "left=1in, right=1in, top=1in, bottom=1in"  
    urlcolor: blue
    linkcolor: blue
    citecolor: blue
    toccolor: blue
    includes:
      in_header: "preamble.tex"
  

---

```{r setup, include=FALSE}

# set the working directory for the code chunks to the project directory rather than 
# the directory in which the Rmd document is housed.

# Don't print any messages, warnings, or code.

knitr::opts_knit$set(root.dir = rprojroot::find_rstudio_root_file(),
                     echo = FALSE, 
                     message = FALSE, 
                     warning = FALSE)

xfun::pkg_attach(c("tidyverse", "rgl"))

```

## Summary of tests

```{r}
test_dates <- params$test_dates

```

```{r read-raw-data}

mesh_directories <- paste0(here::here("analysis", "data", "derived_data", "processed_meshes"), "/", test_dates, "_processed_meshes")

mesh_file_paths <- purrr::map(.x = mesh_directories, .f = ~list.files(path = ., pattern = "[.]ply$", full.names = T)) %>% 
  purrr::reduce(.x = ., .f = c)

# read mesh files into current R session and enframe them in a tibble

meshes <- mesh_file_paths %>% 
  soilmesh::read_meshfiles()


```


```{r}

```


## Plot of water content vs. derived mesh metrics 

```{r}
# map color to date
# facet by metric
```

## Plot of water content vs. clock time (i.e. drying rates)

```{r}
# drydown_analysis()
```

## Screenshots of each mesh 

<!-- label with water content (probably use `magick::image_ggplot()` or possibly **patchwork**) -->


```{r eval= T}

soilmesh::mesh_snapshot(mesh = mesheR::colorMesh(meshes$mesh_object[[1]], col = inf_col), outfile ="analysis/data/derived_data/mesh_snapshots/tbr_mix01_2021-01-15_cyl01.png", aspect_ratio = "16x9", overwrite = F)


args <- tibble::tibble(
  outfile = c("analysis/data/derived_data/mesh_snapshots/tbr_mix01_2021-01-15_cyl01.png",
              "analysis/data/derived_data/mesh_snapshots/tbr_mix01_2021-01-15_cyl02.png"),
  mesh = meshes$mesh_object[1:2],
  aspect_ratio = "4x3",
  overwrite = TRUE
)

args %>% 
  pwalk(soilmesh::mesh_snapshot)
```

## Colophon


### Colophon

This report was generated ` `r strftime(Sys.time(), format = '%a %e %b %Y, %I:%M %p')` ` using the following R packages:

```{r colophon, cache = FALSE, include=TRUE, echo=FALSE, eval= F}
# which R packages and versions?

sessioninfo::package_info()

#if ("devtools" %in% installed.packages()) {
#  devtools::session_info()
#}
```

The current Git commit details are:

```{r git-details, cache = FALSE, include=TRUE, echo=FALSE , eval= F}
# what commit is this file at? 
if ("git2r" %in% installed.packages() & git2r::in_repository(path = ".")){
  git2r::repository(here::here())  
}
```

